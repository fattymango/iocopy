<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body, html {
			width: 100%;
			height: 100%;
			background-color: #000000;
			overflow: hidden;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		#screenImage {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
			image-rendering: -webkit-optimize-contrast;
			image-rendering: crisp-edges;
		}
	</style>
</head>
<body>
	<img id="screenImage" src="" alt="Remote Screen" />
	<script>
		// Get reference to the image element
		const screenImage = document.getElementById('screenImage');

		// Connect to WebSocket server for frame streaming
		const wsPort = 8765;
		let ws = null;
		let reconnectAttempts = 0;
		const maxReconnectAttempts = 10;

		function connectWebSocket() {
			try {
				ws = new WebSocket('ws://127.0.0.1:' + wsPort + '/frames');
				
				ws.onopen = function() {
					console.log('[blackscreen] WebSocket connected');
					reconnectAttempts = 0;
				};

				ws.onmessage = function(event) {
					if (event.data) {
						// Update image source with base64 data
						screenImage.src = 'data:image/jpeg;base64,' + event.data;
					}
				};

				ws.onerror = function(error) {
					console.error('[blackscreen] WebSocket error:', error);
				};

				ws.onclose = function() {
					console.log('[blackscreen] WebSocket closed, attempting to reconnect...');
					ws = null;
					
					// Attempt to reconnect
					if (reconnectAttempts < maxReconnectAttempts) {
						reconnectAttempts++;
						setTimeout(connectWebSocket, 1000 * reconnectAttempts); // Exponential backoff
					} else {
						console.error('[blackscreen] Max reconnection attempts reached');
					}
				};
			} catch (error) {
				console.error('[blackscreen] Failed to create WebSocket:', error);
				// Retry after a delay
				if (reconnectAttempts < maxReconnectAttempts) {
					reconnectAttempts++;
					setTimeout(connectWebSocket, 1000 * reconnectAttempts);
				}
			}
		}

		// Start WebSocket connection
		connectWebSocket();

		// Cleanup on page unload
		window.addEventListener('beforeunload', function() {
			if (ws) {
				ws.close();
			}
		});

		// Listen for Ctrl+Shift+B hotkey
		document.addEventListener('keydown', function(e) {
			if (e.key === 'B' || e.key === 'b') {
				if (e.ctrlKey && e.shiftKey) {
					e.preventDefault();
					// Signal hotkey detected
					window.go.control.BlackScreenApp.OnHotkey();
				}
			}
		});

		// Prevent context menu
		document.addEventListener('contextmenu', function(e) {
			e.preventDefault();
		});

		// Prevent default behaviors
		document.addEventListener('selectstart', function(e) {
			e.preventDefault();
		});
	</script>
</body>
</html>


